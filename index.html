<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Development cache-busting -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>LOS App - Last One Standing</title>
    <!-- Cache-busting timestamp: 2025-09-07T22:10:00Z -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/Logo Round1.png">
    
    <!-- CSS with cache-busting for development -->
    <link rel="stylesheet" href="css/styles.css?v=1.0.1">
    <link rel="stylesheet" href="css/components.css?v=1.0.1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Loading LOS App...</h2>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="authContainer" class="auth-container hidden">
        <div class="auth-card">
            <div class="auth-header">
                <img src="images/Logo Round1.png" alt="LOS App Logo" class="auth-logo">
                <h1>Last One Standing</h1>
                <p>Football Prediction Game</p>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form hidden">
                <div class="form-group">
                    <label for="regName">Full Name</label>
                    <input type="text" id="regName" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" required>
                </div>
                <div class="form-group">
                    <label for="clubSelect">Select Club</label>
                    <select id="clubSelect" required>
                        <option value="">Choose a club...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editionSelect">Select Edition</label>
                    <select id="editionSelect" required>
                        <option value="">Choose an edition...</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Register</button>
            </form>

            <div class="auth-switch">
                <span id="switchToRegister">Don't have an account? Register</span>
                <span id="switchToLogin" class="hidden">Already have an account? Sign In</span>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="app-container hidden">
        <!-- Header -->
        <header class="app-header" role="banner">
            <div class="header-content">
                <!-- Left Logo - spans both rows -->
                <img src="images/Logo Round1.png" alt="LOS App Logo" class="header-logo header-logo-left">
                
                <!-- Main Content Area -->
                <div class="header-main">
                    <!-- First Row: Title -->
                    <div class="header-row header-row-top">
                        <h1>Last One Standing</h1>
                    </div>
                    
                    <!-- Second Row: Controls -->
                    <div class="header-row header-row-bottom">
                        <div class="header-controls">
                            <div class="club-selector">
                                <label for="headerClubSelect" class="sr-only">Select Club</label>
                                <select id="headerClubSelect" class="club-select" aria-label="Select Club">
                                    <option value="">Select Club...</option>
                                </select>
                                <label for="headerEditionSelect" class="sr-only">Select Edition</label>
                                <select id="headerEditionSelect" class="edition-select" aria-label="Select Edition">
                                    <option value="">Select Edition...</option>
                                </select>
                            </div>
                            <div class="user-info">
                                <span id="userName" aria-label="Current user">Player</span>
                                <div id="userLives" class="lives-indicator" aria-label="User lives remaining">
                                    <!-- Lives will be populated by JavaScript -->
                                </div>
                            </div>
                            <!-- Admin and Super Admin buttons will be inserted here by JavaScript -->
                            <div id="adminButtonsContainer"></div>
                            <!-- Connection Status Indicator - Hidden by default, shown only when needed -->
                            <div id="connectionStatus" class="connection-status hidden" role="status" aria-live="polite">
                                <i class="fas fa-circle" aria-hidden="true"></i>
                                <span id="connectionText">Connecting...</span>
                            </div>
                            <!-- Refresh button - Hidden by default, shown only when needed -->
                            <button id="resetConnectionBtn" class="btn btn-warning btn-sm hidden" 
                                    title="Reset Firebase Connection" 
                                    aria-label="Reset Firebase Connection">
                                <i class="fas fa-sync-alt" aria-hidden="true"></i>
                            </button>
                            <button id="logoutBtn" class="btn btn-secondary" 
                                    title="Logout" 
                                    aria-label="Logout">
                                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Right Logo - spans both rows -->
                <img src="images/Logo Round1.png" alt="LOS App Logo" class="header-logo header-logo-right">
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="app-nav" role="navigation" aria-label="Main navigation">
            <div class="nav-tabs" role="tablist">
                <button class="nav-tab active" data-tab="fixtures" role="tab" aria-selected="true" aria-controls="fixturesTab">
                    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                    <span>Fixtures</span>
                </button>
                <button class="nav-tab" data-tab="picks" role="tab" aria-selected="false" aria-controls="picksTab">
                    <i class="fas fa-list-check" aria-hidden="true"></i>
                    <span>My Picks</span>
                </button>
                <button class="nav-tab" data-tab="standings" role="tab" aria-selected="false" aria-controls="standingsTab">
                    <i class="fas fa-trophy" aria-hidden="true"></i>
                    <span>As It Stands</span>
                </button>
                <button class="nav-tab" data-tab="scores" role="tab" aria-selected="false" aria-controls="scoresTab">
                    <i class="fas fa-futbol" aria-hidden="true"></i>
                    <span>Scores</span>
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content" class="app-main" role="main">
            <!-- Fixtures Tab -->
            <div id="fixturesTab" class="tab-content active" role="tabpanel" aria-labelledby="fixtures-tab">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h2>Gameweek <span id="currentGameweek">1</span> Fixtures</h2>
                        <div class="deadline-info">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                            <span id="deadlineText">Deadline: Loading...</span>
                        </div>
                    </div>
                    <div class="tab-header-right">
                        <div class="gameweek-navigation">
                            <button id="prevGameweek" class="btn btn-secondary btn-sm" 
                                    title="Previous Gameweek" 
                                    aria-label="Previous Gameweek">
                                <i class="fas fa-chevron-left" aria-hidden="true"></i>
                            </button>
                            <label for="gameweekSelect" class="sr-only">Select Gameweek</label>
                            <select id="gameweekSelect" class="gameweek-select" aria-label="Select Gameweek">
                                <option value="1">Gameweek 1</option>
                                <option value="2">Gameweek 2</option>
                                <option value="3">Gameweek 3</option>
                                <option value="4">Gameweek 4</option>
                                <option value="5">Gameweek 5</option>
                                <option value="6">Gameweek 6</option>
                                <option value="7">Gameweek 7</option>
                                <option value="8">Gameweek 8</option>
                                <option value="9">Gameweek 9</option>
                                <option value="10">Gameweek 10</option>
                            </select>
                            <button id="nextGameweek" class="btn btn-secondary btn-sm" 
                                    title="Next Gameweek" 
                                    aria-label="Next Gameweek">
                                <i class="fas fa-chevron-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="fixturesList" class="fixtures-list" role="region" aria-label="Fixtures list">
                    <!-- Loading state for fixtures -->
                    <div id="fixturesLoading" class="loading-state" role="status" aria-live="polite">
                        <div class="loading-spinner-small" aria-hidden="true"></div>
                        <p>Loading fixtures...</p>
                    </div>
                    <!-- Fixtures will be loaded here -->
                </div>
            </div>

            <!-- My Picks Tab -->
            <div id="picksTab" class="tab-content">
                <div class="tab-header">
                    <h2>My Pick History</h2>
                </div>
                <div id="picksList" class="picks-list">
                    <!-- Loading state for picks -->
                    <div id="picksLoading" class="loading-state">
                        <div class="loading-spinner-small"></div>
                        <p>Loading pick history...</p>
                    </div>
                    <!-- Pick history will be loaded here -->
                </div>
            </div>

            <!-- Standings Tab -->
            <div id="standingsTab" class="tab-content">
                <div class="tab-header">
                    <h2>As It Stands</h2>
                </div>
                <div id="standingsList" class="standings-list">
                    <!-- Loading state for standings -->
                    <div id="standingsLoading" class="loading-state">
                        <div class="loading-spinner-small"></div>
                        <p>Loading standings...</p>
                    </div>
                    <!-- Standings will be loaded here -->
                </div>
            </div>

            <!-- Scores Tab -->
            <div id="scoresTab" class="tab-content">
                <div class="tab-header">
                    <h2>Live Scores</h2>
                </div>
                <div id="scoresList" class="scores-list">
                    <!-- Loading state for scores -->
                    <div id="scoresLoading" class="loading-state">
                        <div class="loading-spinner-small"></div>
                        <p>Loading scores...</p>
                    </div>
                    <!-- Live scores will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Admin Panel (Hidden by default) -->
    <div id="adminPanel" class="admin-panel hidden">
        <div class="admin-header">
            <h2>Admin Panel</h2>
            <button id="closeAdmin" class="btn btn-secondary">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="admin-content">
            <div class="admin-tabs">
                <button class="admin-tab active" data-admin-tab="users">Users</button>
                <button class="admin-tab" data-admin-tab="fixtures">Fixtures</button>
                <button class="admin-tab" data-admin-tab="scores">Scores</button>
                <button class="admin-tab" data-admin-tab="settings">Settings</button>
            </div>
            <div id="adminContent" class="admin-content-area">
                <!-- Admin content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="pickModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Your Pick</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to pick <strong id="pickTeamName"></strong>?</p>
                <p class="warning">This pick cannot be changed after the deadline!</p>
            </div>
            <div class="modal-footer">
                <button id="confirmPick" class="btn btn-primary">Confirm Pick</button>
                <button id="cancelPick" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Error Toast Notification -->
    <div id="errorToast" class="toast toast-error hidden">
        <div class="toast-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorMessage">An error occurred</span>
        </div>
        <button class="toast-close">&times;</button>
    </div>

    <!-- Success Toast Notification -->
    <div id="successToast" class="toast toast-success hidden">
        <div class="toast-content">
            <i class="fas fa-check-circle"></i>
            <span id="successMessage">Operation completed successfully</span>
        </div>
        <button class="toast-close">&times;</button>
    </div>

    <!-- Info Toast Notification -->
    <div id="infoToast" class="toast toast-info hidden">
        <div class="toast-content">
            <i class="fas fa-info-circle"></i>
            <span id="infoMessage">Information message</span>
        </div>
        <button class="toast-close">&times;</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

        <!-- ConsoleLogger service will be loaded from js/services/ConsoleLogger.js -->

    <!-- App Scripts with cache-busting for development -->
    <!-- Environment Loader (load first) -->
    <script src="js/config/env-loader.js?v=2.0.0"></script>
    
    <!-- Core Services -->
    <script src="js/services/ConsoleLogger.js?v=2.0.0"></script>
    <script src="js/services/UIService.js?v=2.0.0"></script>
    <script src="js/services/PerformanceOptimizer.js?v=2.0.1"></script>
    <script src="js/services/TeamBadgeService.js?v=2.0.0"></script>
    <script src="js/services/EmailService.js?v=2.0.0"></script>
    <script src="js/services/PerformanceService.js?v=2.0.0"></script>
    
    <!-- Base Manager Class -->
    <script src="js/managers/BaseManager.js?v=2.0.0"></script>
    
    <!-- Manager Classes -->
    <script src="js/managers/AuthManager.js?v=2.0.1"></script>
    <script src="js/managers/EditionService.js?v=2.0.0"></script>
    <script src="js/managers/FixturesManager.js?v=2.0.1"></script>
    <script src="js/managers/ScoresManager.js?v=2.0.2"></script>
    <script src="js/managers/GameLogicManager.js?v=2.0.0"></script>
    <script src="js/managers/PickStatusService.js?v=2.0.0"></script>
    <script src="js/managers/DeadlineService.js?v=2.0.0"></script>
    <script src="js/managers/AdminManager.js?v=2.0.1"></script>
    <script src="js/managers/ClubService.js?v=2.0.3"></script>
    <script src="js/managers/SuperAdminManager.js?v=2.0.0"></script>
    <script src="js/managers/FixtureManagementManager.js?v=2.0.0"></script>
    
    <!-- API Modules -->
    <script src="js/modules/api/developmentHelper.js?v=1.0.0"></script>
    <script src="js/modules/api/footballWebPages.js?v=1.0.0"></script>
    
    <!-- Database and Setup -->
    <!-- Removed init-database.js and add-sample-fixtures.js - these were creating fake Premier League fixtures -->
    <script src="js/migration/migrate-to-multiclub.js?v=1.0.0"></script>
    <script src="js/setup/sample-clubs.js?v=1.0.0"></script>
    <script src="js/setup/download-team-badges.js?v=1.0.0"></script>
    
    <!-- Main App -->
    <script src="js/app.js?v=2.0.5"></script>
    
    <!-- Database Cleanup Script -->

    

    
    <!-- Firebase Cleanup Functions - Production Ready -->
    <script>
        // Production cleanup functions (minimal logging)
        window.cleanupFirebase = async function() {
            if (!window.firebaseDB) {
                console.error('Firebase database not available');
                return;
            }
            
            const collectionsToDelete = ['users', 'picks', 'editions', 'fixtures', 'scores'];
            
            for (const collectionName of collectionsToDelete) {
                try {
                    const snapshot = await window.firebaseDB.collection(collectionName).get();
                    
                    if (!snapshot.empty) {
                        const batch = window.firebaseDB.batch();
                        snapshot.docs.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        await batch.commit();
                    }
                } catch (error) {
                    console.error(`Error cleaning up ${collectionName}:`, error);
                }
            }
        };
        
        window.showFirebaseStructure = async function() {
            if (!window.firebaseDB) {
                console.error('Firebase database not available');
                return;
            }
            
            try {
                const clubsSnapshot = await window.firebaseDB.collection('clubs').get();
                console.log(`Found ${clubsSnapshot.size} clubs`);
                
                for (const clubDoc of clubsSnapshot.docs) {
                    const editionsSnapshot = await clubDoc.ref.collection('editions').get();
                    console.log(`Club ${clubDoc.id}: ${editionsSnapshot.size} editions`);
                }
            } catch (error) {
                console.error('Error checking structure:', error);
            }
        };
        
        window.verifyFirebaseCleanup = async function() {
            if (!window.firebaseDB) {
                console.error('Firebase database not available');
                return;
            }
            
            const collectionsToDelete = ['users', 'picks', 'editions', 'fixtures', 'scores'];
            
            for (const collectionName of collectionsToDelete) {
                try {
                    const snapshot = await window.firebaseDB.collection(collectionName).limit(1).get();
                    if (!snapshot.empty) {
                        console.log(`${collectionName}: Still has documents`);
                    }
                } catch (error) {
                    console.log(`${collectionName}: Error checking - ${error.message}`);
                }
            }
        };
        
        // üîç INVESTIGATION TOOLS for debugging fake fixtures issue
        window.investigateFakeFixtures = async function() {
            console.log('üîç Investigating fake fixtures issue...');
            
            if (!window.firebaseDB) {
                console.error('‚ùå Firebase database not available');
                return;
            }
            
            try {
                // Check old fixtures collection
                console.log('üìã Checking old fixtures collection...');
                const oldFixturesSnapshot = await window.firebaseDB.collection('fixtures').get();
                
                if (oldFixturesSnapshot.empty) {
                    console.log('‚úÖ Old fixtures collection is empty - no fake fixtures found here');
                } else {
                    console.log(`‚ö†Ô∏è Found ${oldFixturesSnapshot.size} documents in old fixtures collection:`);
                    
                    oldFixturesSnapshot.forEach(doc => {
                        const data = doc.data();
                        console.log(`üìÑ Document ID: ${doc.id}`);
                        console.log('üìä Data:', data);
                        
                        // Check if this contains the fake Premier League fixtures
                        if (data.fixtures && Array.isArray(data.fixtures)) {
                            const fakeTeams = ['Arsenal', 'Chelsea', 'Liverpool', 'Manchester City', 'Manchester United', 'Tottenham', 'Newcastle', 'Aston Villa', 'Brighton', 'West Ham'];
                            const hasFakeFixtures = data.fixtures.some(fixture => 
                                fakeTeams.includes(fixture.homeTeam) || fakeTeams.includes(fixture.awayTeam)
                            );
                            
                            if (hasFakeFixtures) {
                                console.log('üö® FAKE FIXTURES FOUND in this document!');
                                console.log('Teams found:', data.fixtures.map(f => `${f.homeTeam} vs ${f.awayTeam}`));
                            }
                        }
                    });
                }
                
                // Check new multi-club structure
                console.log('üèÜ Checking new multi-club structure...');
                const clubsSnapshot = await window.firebaseDB.collection('clubs').get();
                
                if (clubsSnapshot.empty) {
                    console.log('‚ö†Ô∏è No clubs found in new structure');
                } else {
                    console.log(`‚úÖ Found ${clubsSnapshot.size} clubs in new structure`);
                    
                    for (const clubDoc of clubsSnapshot.docs) {
                        const clubId = clubDoc.id;
                        console.log(`üèüÔ∏è Club: ${clubId}`);
                        
                        const editionsSnapshot = await window.firebaseDB.collection('clubs').doc(clubId).collection('editions').get();
                        if (!editionsSnapshot.empty) {
                            console.log(`  üìö Editions: ${editionsSnapshot.size}`);
                            
                            for (const editionDoc of editionsSnapshot.docs) {
                                const editionId = editionDoc.id;
                                console.log(`    üìñ Edition: ${editionId}`);
                                
                                const fixturesSnapshot = await window.firebaseDB.collection('clubs').doc(clubId)
                                    .collection('editions').doc(editionId)
                                    .collection('fixtures').get();
                                
                                if (!fixturesSnapshot.empty) {
                                    console.log(`      üìã Fixtures: ${fixturesSnapshot.size} fixture documents`);
                                    
                                    // Group fixtures by gameWeek to show actual structure
                                    const fixturesByGameweek = {};
                                    fixturesSnapshot.forEach(fixtureDoc => {
                                        const fixtureData = fixtureDoc.data();
                                        const gameWeek = fixtureData.gameWeek || 'unknown';
                                        if (!fixturesByGameweek[gameWeek]) {
                                            fixturesByGameweek[gameWeek] = [];
                                        }
                                        fixturesByGameweek[gameWeek].push({
                                            id: fixtureDoc.id,
                                            homeTeam: fixtureData.homeTeam,
                                            awayTeam: fixtureData.awayTeam,
                                            date: fixtureData.date,
                                            status: fixtureData.status
                                        });
                                    });
                                    
                                    // Display grouped fixtures
                                    Object.keys(fixturesByGameweek).sort().forEach(gameWeek => {
                                        const fixtures = fixturesByGameweek[gameWeek];
                                        console.log(`        ‚Ä¢ Gameweek ${gameWeek}: ${fixtures.length} fixtures`);
                                        fixtures.forEach(fixture => {
                                            console.log(`          - ${fixture.homeTeam} vs ${fixture.awayTeam} (${fixture.date}) [${fixture.status}]`);
                                        });
                                    });
                                } else {
                                    console.log(`      üìã No fixtures found`);
                                }
                            }
                        } else {
                            console.log(`  üìö No editions found`);
                        }
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Error during investigation:', error);
            }
        };
        
        // üßπ Clean up old fixtures collection
        window.cleanupOldFixtures = async function() {
            console.log('üßπ Cleaning up old fixtures collection...');
            
            if (!window.firebaseDB) {
                console.error('‚ùå Firebase database not available');
                return;
            }
            
            try {
                const oldFixturesSnapshot = await window.firebaseDB.collection('fixtures').get();
                
                if (oldFixturesSnapshot.empty) {
                    console.log('‚úÖ Old fixtures collection is already empty');
                    return;
                }
                
                // Delete all documents in the old fixtures collection
                const batch = window.firebaseDB.batch();
                oldFixturesSnapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                console.log(`‚úÖ Successfully deleted ${oldFixturesSnapshot.size} documents from old fixtures collection`);
                
            } catch (error) {
                console.error('‚ùå Error cleaning up old fixtures:', error);
            }
        };
        
        console.log('üîç INVESTIGATION TOOLS added!');
        console.log('Available functions: investigateFakeFixtures(), cleanupOldFixtures()');
        
        // üîç Check current gameweek fixtures specifically
        window.checkCurrentGameweekFixtures = async function() {
            console.log('üîç Checking current gameweek fixtures...');
            
            if (!window.firebaseDB) {
                console.error('‚ùå Firebase database not available');
                return;
            }
            
            try {
                // Get current club and edition
                const currentClubId = window.losApp?.managers?.club?.getCurrentClub() || 'altrincham-fc-juniors';
                const currentEdition = window.losApp?.managers?.club?.getCurrentEdition() || '2025-26-national-league-1';
                const currentGameweek = window.editionService?.getCurrentGameweek() || 3;
                
                console.log(`üîç Checking fixtures for Club: ${currentClubId}, Edition: ${currentEdition}, Gameweek: ${currentGameweek}`);
                
                // Check new structure for current gameweek
                const fixturesSnapshot = await window.firebaseDB.collection('clubs').doc(currentClubId)
                    .collection('editions').doc(currentEdition)
                    .collection('fixtures')
                    .where('gameWeek', '==', currentGameweek)
                    .get();
                
                if (fixturesSnapshot.empty) {
                    console.log(`‚ö†Ô∏è No fixtures found in new structure for Gameweek ${currentGameweek}`);
                    console.log('üîç This explains why no fixtures are showing!');
                } else {
                    console.log(`‚úÖ Found ${fixturesSnapshot.size} fixtures in new structure for Gameweek ${currentGameweek}:`);
                    
                    fixturesSnapshot.forEach(fixtureDoc => {
                        const fixtureData = fixtureDoc.data();
                        console.log(`  ‚Ä¢ ${fixtureData.homeTeam} vs ${fixtureData.awayTeam}`);
                        console.log(`    Date: ${fixtureData.date}, Time: ${fixtureData.time || fixtureData.kickOffTime}`);
                        console.log(`    Status: ${fixtureData.status}, Scores: ${fixtureData.homeScore || 'null'} - ${fixtureData.awayScore || 'null'}`);
                    });
                }
                
                // Also check what gameweeks are available
                const allFixturesSnapshot = await window.firebaseDB.collection('clubs').doc(currentClubId)
                    .collection('editions').doc(currentEdition)
                    .collection('fixtures')
                    .orderBy('gameWeek')
                    .get();
                
                if (!allFixturesSnapshot.empty) {
                    const gameweeks = {};
                    allFixturesSnapshot.forEach(doc => {
                        const gameWeek = doc.data().gameWeek;
                        if (gameWeek) {
                            gameweeks[gameWeek] = (gameweeks[gameWeek] || 0) + 1;
                        }
                    });
                    
                    console.log('üìä Available gameweeks and fixture counts:');
                    Object.keys(gameweeks).sort((a, b) => parseInt(a) - parseInt(b)).forEach(gw => {
                        console.log(`  ‚Ä¢ Gameweek ${gw}: ${gameweeks[gw]} fixtures`);
                    });
                }
                
            } catch (error) {
                console.error('‚ùå Error checking current gameweek fixtures:', error);
            }
        };
        
        console.log('üîç Additional function added: checkCurrentGameweekFixtures()');
        
        // üîç Check picks collection for data inconsistencies
        window.investigatePicksCollection = async function() {
            console.log('üîç Investigating picks collection...');
            
            if (!window.firebaseDB) {
                console.error('‚ùå Firebase database not available');
                return;
            }
            
            try {
                const currentClubId = window.losApp?.managers?.club?.getCurrentClub() || 'altrincham-fc-juniors';
                const currentEdition = window.losApp?.managers?.club?.getCurrentEdition() || '2025-26-national-league-1';
                const currentGameweek = window.editionService?.getCurrentGameweek() || 1;
                
                console.log(`üîç Checking picks for Club: ${currentClubId}, Edition: ${currentEdition}, Gameweek: ${currentGameweek}`);
                
                // Check picks collection
                const picksSnapshot = await window.firebaseDB.collection('clubs').doc(currentClubId)
                    .collection('editions').doc(currentEdition)
                    .collection('picks')
                    .where('gameweek', '==', currentGameweek)
                    .get();
                
                if (picksSnapshot.empty) {
                    console.log(`‚ÑπÔ∏è No picks found for Gameweek ${currentGameweek}`);
                } else {
                    console.log(`üìä Found ${picksSnapshot.size} picks for Gameweek ${currentGameweek}:`);
                    
                    picksSnapshot.forEach(doc => {
                        const pickData = doc.data();
                        console.log(`  üìÑ Pick ID: ${doc.id}`);
                        console.log(`    User ID: ${pickData.userId}`);
                        console.log(`    Team Picked: ${pickData.teamPicked || 'NULL'}`);
                        console.log(`    Is Autopick: ${pickData.isAutopick}`);
                        console.log(`    Lives After Pick: ${pickData.livesAfterPick || 'NULL'}`);
                        console.log(`    Saved At: ${pickData.savedAt?.toDate?.() || pickData.savedAt}`);
                        console.log(`    Fixture ID: ${pickData.fixtureId || 'NULL'}`);
                        console.log(`    Result: ${pickData.result || 'NULL'}`);
                        console.log('    ---');
                    });
                }
                
                // Also check for any picks with null teamPicked
                const nullTeamPicksSnapshot = await window.firebaseDB.collection('clubs').doc(currentClubId)
                    .collection('editions').doc(currentEdition)
                    .collection('picks')
                    .where('teamPicked', '==', null)
                    .get();
                
                if (!nullTeamPicksSnapshot.empty) {
                    console.log(`‚ö†Ô∏è Found ${nullTeamPicksSnapshot.size} picks with NULL teamPicked:`);
                    nullTeamPicksSnapshot.forEach(doc => {
                        const pickData = doc.data();
                        console.log(`  üö® Pick ID: ${doc.id}`);
                        console.log(`    User ID: ${pickData.userId}`);
                        console.log(`    Gameweek: ${pickData.gameweek}`);
                        console.log(`    Is Autopick: ${pickData.isAutopick}`);
                        console.log(`    Saved At: ${pickData.savedAt?.toDate?.() || pickData.savedAt}`);
                    });
                }
                
            } catch (error) {
                console.error('‚ùå Error investigating picks:', error);
            }
        };
        
        console.log('üîç Additional function added: investigatePicksCollection()');
        
        // üßπ Clean up invalid picks with NULL teamPicked
        window.cleanupInvalidPicks = async function() {
            console.log('üßπ Cleaning up invalid picks with NULL teamPicked...');
            
            if (!window.firebaseDB) {
                console.error('‚ùå Firebase database not available');
                return;
            }
            
            try {
                const currentClubId = window.losApp?.managers?.club?.getCurrentClub() || 'altrincham-fc-juniors';
                const currentEdition = window.losApp?.managers?.club?.getCurrentEdition() || '2025-26-national-league-1';
                
                console.log(`üîç Looking for invalid picks in Club: ${currentClubId}, Edition: ${currentEdition}`);
                
                // Find all picks with NULL teamPicked
                const nullTeamPicksSnapshot = await window.firebaseDB.collection('clubs').doc(currentClubId)
                    .collection('editions').doc(currentEdition)
                    .collection('picks')
                    .where('teamPicked', '==', null)
                    .get();
                
                if (nullTeamPicksSnapshot.empty) {
                    console.log('‚úÖ No invalid picks found to clean up');
                    return;
                }
                
                console.log(`‚ö†Ô∏è Found ${nullTeamPicksSnapshot.size} invalid picks to clean up:`);
                
                // Delete all invalid picks
                const batch = window.firebaseDB.batch();
                nullTeamPicksSnapshot.forEach(doc => {
                    const pickData = doc.data();
                    console.log(`  üóëÔ∏è Deleting pick ID: ${doc.id}`);
                    console.log(`    User ID: ${pickData.userId}, Gameweek: ${pickData.gameweek}`);
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                console.log(`‚úÖ Successfully deleted ${nullTeamPicksSnapshot.size} invalid picks`);
                
                // Verify cleanup
                const verifySnapshot = await window.firebaseDB.collection('clubs').doc(currentClubId)
                    .collection('editions').doc(currentEdition)
                    .collection('picks')
                    .where('teamPicked', '==', null)
                    .get();
                
                if (verifySnapshot.empty) {
                    console.log('‚úÖ Verification: All invalid picks have been removed');
                } else {
                    console.log(`‚ö†Ô∏è Verification: Still found ${verifySnapshot.size} invalid picks`);
                }
                
            } catch (error) {
                console.error('‚ùå Error cleaning up invalid picks:', error);
            }
        };
        
        console.log('üßπ Additional function added: cleanupInvalidPicks()');
    </script>
    

</body>
</html>
